"""
    Simple Usage example (with 3 images)
"""
from mean_average_precision.detection_map import DetectionMAP
from mean_average_precision.utils.show_frame import show_frame
import numpy as np

pred_bb1 = np.array([[0.7580688, 0.39609185, 0.88696718, 0.55476958],
                     [0.94020283, 0.39787981, 0.99351478, 0.54294884],
                     [0.78723741, 0.61799151, 0.9083041, 0.75623035],
                     [0.22078986, 0.30151826, 0.36679274, 0.40551913],
                     [0.0041579, 0.48359361, 0.06867643, 0.60145104],
                     [0.2731401, 0.77888632, 0.40164948, 0.90546954],
                     [0.75489414, 0.75228018, 0.87922037, 0.88110524],
                     [0.21953127, 0.77934921, 0.34853417, 0.90626764],
                     [0.24051605, 0.23196566, 0.35833153, 0.33802736],
                     [0.78038442, 0.80548406, 0.90756017, 0.93249702],
                     [0.24679801, 0.83207512, 0.37549466, 0.95796412],
                     [0.22046396, 0.64581937, 0.34768161, 0.77288234],
                     [-0.00134033, 0.46624103, 0.0766544, 0.62501442],
                     [0.94020283, 0.39787981, 0.99351478, 0.54294884],
                     [0.23281434, 0.28093183, 0.38461, 0.42689067],
                     [0.55478632, 0.42387292, 0.63996112, 0.55162096],
                     [0.48925012, 0.38768935, 0.65581638, 0.61141169],
                     [0.56840801, 0.32083702, 0.71154857, 0.46629971],
                     [0.13658944, 0.2169033, 0.29752737, 0.40133834],
                     [0.94020283, 0.39787981, 0.99351478, 0.54294884],
                     [-0.00134033, 0.46624103, 0.0766544, 0.62501442],
                     [0.02127808, 0.58518475, 0.11950979, 0.70955998],
                     [0.8502323, 0.39479384, 0.98994809, 0.55142802],
                     [0.50395149, 0.57312971, 0.65483707, 0.76372123],
                     [0.96695906, 0.60318351, 0.9955948, 0.71194023],
                     [0.45621544, 0.30601835, 0.76329058, 0.77618062],
                     [0.17941663, 0.22990146, 0.36221492, 0.41499656],
                     [0.00249222, 0.46199691, 0.07383271, 0.6138972],
                     [0.3759388, 0.27013046, 0.50930011, 0.41453394],
                     [0.87020957, 0.47026289, 0.97900838, 0.61376369]])
pred_cls1 = np.array([3, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 2, 2, 2, 2, 0, 2, 3, 4, 4, 5, 5])
pred_conf1 = np.array([0.9814553, 0.69030029, 0.82539449, 0.32069851, 0.31828372, 0.21807292,
                       0.5805561, 0.01781065, 0.01775323, 0.01766941, 0.01743063, 0.11741253,
                       0.09830754, 0.07163116, 0.03224663, 0.01671508, 0.01559712, 0.41229035,
                       0.31036408, 0.52288718, 0.11103436, 0.04442989, 0.01403897, 0.01308262,
                       0.71004123, 0.67468299, 0.78280323, 0.49345433, 0.68520535, 0.77690332])
gt_bb1 = np.array([[0.86132812, 0.48242188, 0.97460938, 0.6171875],
                   [0.18554688, 0.234375, 0.36132812, 0.41601562],
                   [0., 0.47265625, 0.0703125, 0.62109375],
                   [0.47070312, 0.3125, 0.77929688, 0.78125],
                   [0.375, 0.26757812, 0.50976562, 0.40625],
                   [0.94726562, 0.40234375, 0.99804688, 0.54492188]])
gt_cls1 = np.array([5, 4, 4, 3, 1, 2])

pred_bb2 = np.array([[0.45451686, 0.25027996, 0.59771222, 0.33920899],
                     [0.40867785, 0.45146519, 0.54074061, 0.56507283],
                     [0.40742272, 0.45048168, 0.54228842, 0.55927515],
                     [0.4929519, 0.54704845, 0.62118375, 0.66670889],
                     [0.62373358, 0.43393397, 0.82830238, 0.68219709],
                     [0.18000965, 0.15882401, 0.28237498, 0.30705762],
                     [0.63386858, 0.48325053, 0.83454424, 0.67515808],
                     [0.37771922, 0.40974259, 0.53947467, 0.53909385],
                     [0.17981568, 0.43252051, 0.33472997, 0.57964849],
                     [0.1672115, 0.435711, 0.32729435, 0.57853043],
                     [0.18287398, 0.15450388, 0.27082703, 0.31132805],
                     [0.3713485, 0.24020095, 0.62879527, 0.48929602]])
pred_cls2 = np.array([0, 0, 1, 1, 2, 4, 4, 4, 4, 5, 5, 6])
pred_conf2 = np.array([0.55527261, 0.72345584, 0.83103319, 0.62304915, 0.87994107, 0.2457653,
                       0.33891142, 0.21127759, 0.11003532, 0.18837614, 0.77496605, 0.27333026])
gt_bb2 = np.array([[0.625, 0.43554688, 0.828125, 0.67382812],
                   [0.45898438, 0.25390625, 0.59179688, 0.34179688],
                   [0.18164062, 0.16015625, 0.28125, 0.31054688],
                   [0.36914062, 0.2421875, 0.64453125, 0.49804688],
                   [0.40234375, 0.44921875, 0.55078125, 0.56445312],
                   [0.16796875, 0.43554688, 0.328125, 0.578125]])
gt_cls2 = np.array([2, 0, 0, 6, 1, 5])

pred_bb3 = np.array([[6.13698244e-01, 5.96838057e-01, 7.39164412e-01, 7.07642615e-01],
                     [2.82014966e-01, 3.56518567e-01, 4.01157647e-01, 4.48181391e-01],
                     [4.51987743e-01, 2.66010880e-01, 5.85281968e-01, 3.63116354e-01],
                     [1.65119708e-01, 7.88646698e-01, 2.89986700e-01, 8.87400329e-01],
                     [9.63111043e-01, 3.85968924e-01, 9.98284340e-01, 4.40357149e-01],
                     [5.64328015e-01, 6.32351279e-01, 6.86717212e-01, 7.53823996e-01],
                     [2.59786099e-01, 2.96133190e-01, 3.72013390e-01, 4.22464013e-01],
                     [3.49433213e-01, 8.54072988e-01, 4.71348315e-01, 9.41482127e-01],
                     [6.18426085e-01, 8.45086455e-01, 7.46362984e-01, 9.42002118e-01],
                     [8.98434073e-02, 7.38716602e-01, 2.11257100e-01, 8.34173083e-01],
                     [5.89835763e-01, 8.21752846e-01, 7.15827405e-01, 9.14091229e-01],
                     [1.70103580e-01, 4.68202889e-01, 3.14743400e-01, 6.40994072e-01],
                     [3.18189263e-01, 2.51943648e-01, 4.20428485e-01, 3.67742836e-01],
                     [3.37862551e-01, 1.04962699e-02, 4.34510559e-01, 1.24129713e-01],
                     [7.39502460e-02, 3.80024582e-01, 1.67675972e-01, 4.96696204e-01],
                     [2.86702722e-01, 5.87677717e-01, 3.90843153e-01, 7.14454949e-01],
                     [2.87590116e-01, 8.76132399e-02, 3.79709303e-01, 2.05121845e-01],
                     [7.62929857e-01, 5.31667829e-01, 8.71559978e-01, 6.13442302e-01],
                     [2.94801354e-01, 8.49847436e-01, 4.23835337e-01, 9.43825901e-01],
                     [7.43638694e-01, 1.85956523e-01, 8.25106919e-01, 3.06358635e-01],
                     [1.65119708e-01, 7.88646698e-01, 2.89986700e-01, 8.87400329e-01],
                     [3.74385774e-01, 3.87587026e-03, 4.56769586e-01, 9.78295356e-02],
                     [2.49986321e-01, 5.35322368e-01, 4.71457690e-01, 8.15080702e-01],
                     [5.34309208e-01, 5.60286283e-01, 7.47848153e-01, 7.79418886e-01],
                     [-1.56410933e-02, 5.08699268e-02, 3.51796091e-01, 4.75510120e-01],
                     [5.27392209e-01, 4.15001065e-03, 9.89107490e-01, 2.53379673e-01],
                     [3.80206704e-01, 2.17772663e-01, 8.35944176e-01, 5.64223588e-01],
                     [3.24515402e-02, 1.22340471e-02, 4.65116441e-01, 3.33164275e-01],
                     [4.86147612e-01, -1.72163174e-03, 6.54646873e-01, 1.25709087e-01],
                     [7.76806474e-03, 2.98454195e-01, 1.51915774e-01, 4.55512702e-01],
                     [1.59867108e-04, 1.68309599e-01, 1.48759156e-01, 3.30601990e-01],
                     [4.60092276e-01, 3.88426706e-03, 5.94684362e-01, 1.03428453e-01],
                     [5.63124001e-01, 5.35710901e-03, 6.84089422e-01, 1.02966107e-01],
                     [8.41692090e-05, 8.84180367e-01, 1.29906535e-01, 9.94503617e-01],
                     [1.50298983e-01, 1.51849538e-03, 3.54529858e-01, 1.40629351e-01],
                     [5.16625643e-02, -2.12677829e-02, 2.23492384e-01, 1.43410012e-01],
                     [2.62086391e-01, 2.77327001e-01, 4.12441581e-01, 4.47330356e-01],
                     [4.60915357e-01, 1.89323276e-01, 6.17049217e-01, 3.54278356e-01],
                     [1.37690529e-02, -2.55887881e-02, 1.87012643e-01, 1.69555098e-01],
                     [2.02796862e-01, -5.10895252e-03, 5.27684987e-01, 2.83526838e-01],
                     [-2.82060280e-02, 1.30695906e-02, 3.47097442e-02, 6.17706925e-02]])
pred_cls3 = np.array(
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5,
     6, 6, 6])
pred_conf3 = np.array([0.09096181, 0.07690828, 0.07068601, 0.03777372, 0.0320744, 0.03178779,
                       0.03154377, 0.03148046, 0.03099651, 0.03091793, 0.0300424, 0.05134981,
                       0.04957321, 0.2363426, 0.73216906, 0.02757353, 0.02707205, 0.02114083,
                       0.02094351, 0.01918823, 0.01802124, 0.0177393, 0.9750914, 0.97437322,
                       0.99735022, 0.99036777, 0.7874965, 0.96177179, 0.95303613, 0.716883,
                       0.64981866, 0.57662624, 0.52479589, 0.42882288, 0.40991881, 0.39086857,
                       0.97761214, 0.83941156, 0.03363995, 0.01270511, 0.0118869])
gt_bb3 = np.array([[0.74609375, 0.58007812, 1.05273438, 0.83007812],
                   [0.57226562, 0.234375, 1.14453125, 0.62890625],
                   [0.6640625, 0.2109375, 0.859375, 0.39453125]])
gt_cls3 = np.array([2, 3, 5])

if __name__ == '__main__':
    frames = [(pred_bb1, pred_cls1, pred_conf1, gt_bb1, gt_cls1),
              (pred_bb2, pred_cls2, pred_conf2, gt_bb2, gt_cls2),
              (pred_bb3, pred_cls3, pred_conf3, gt_bb3, gt_cls3)]
    n_class = 7

    mAP = DetectionMAP(n_class)
    for i, frame in enumerate(frames):
        print("Evaluate frame {}".format(i))
        #show_frame(*frame)
        mAP.evaluate(*frame)

    mAP.plot()
